.project_id{ data: {id: @project.id }}
.span12
  = render partial: "calendar"
.clearfix
.span12
  = link_to "Submit", project_url(@project), id: "submit", class: "btn btn-primary pull-right"
.clearfix

#myModal.modal.hide.fade
  .modal-header
    .close{data: {dismiss: "modal"}}
    .h3 Hours Available
  .modal-body
    %table.table.table-bordered{style: "width: 100%"}
      %tr
        %th.top{style: "width: 7.7%"}
        - (1..12).to_a.each do |i|
          %th.top{style: "width: 7.7%"}= i
      %tr
        %td{style: "width: 7.7%"}= "AM"
        - (1..12).to_a.each do |i|
          %td.hours{style: "width: 7.7%", id: "#{i}"}
      %tr
        %td{style: "width: 7.7%"}= "PM"
        - (1..12).to_a.each do |i|
          %td.hours{style: "width: 7.7%", id: "#{i + 12}"}
  .modal-footer

:javascript
  $(function(){
    var id = $('.project_id').data('id')
    var events = {}

    $('.day')
      .css('background', 'white')
      .data('events', 0)

    $('#submit').click(function(){
      console.log(events)
      $.post('/projects/' + id + '/events', {events: events}, function(response){
        window.location.href = '/projects/' + id
      });
    })

    $('.hours').click(function(){
      var hour = $(this)
      if($(hour).data('checked') === 0){
        $(hour)
          .data('checked', 1)
          .css('background', 'green')
      }
      else{
        $(hour)
          .data('checked', 0)
          .css('background', 'white')
      }
    })

    $('.day').click(function(){
      var day = $(this)
      var date = day.data("date-iso")
      
      $('#save').remove()
      $('.hours')
        .css('background', 'white')
        .data('checked', 0)

      if(date in events){
        $.each(events[date], function(i, hour){
          $('.hours#' + hour)
            .css('background', 'green')
            .data('checked', 1)
        })
      }

      var button = $('<button id="save">Save</button>')
        .addClass('btn pull-right')
        .click(function(){
          var datetimes = new Array()
          
          $.each( $('.hours'), function(i, value){
            if ($(value).data('checked') === 1){ datetimes.push(value.id) }
          })
          events[date] = datetimes

          $.each($('.hours'), function(i, value){
            if(datetimes.length){
              day
                .data('events', 1)
                .css('background', 'green')
            }
            else{
              day
                .data('events', 0)
                .css('background', 'white')
            }
          })

          $('#myModal').modal('hide')
        });

      $('.modal-footer').append(button)
      $('#myModal').modal()
    })
  })
